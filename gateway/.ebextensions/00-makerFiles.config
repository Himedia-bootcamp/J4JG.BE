files:
  "/sbin/appstart":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      #!/usr/bin/env bash
      JAR_PATH=/var/app/current/application.jar

      # Kill existing java processes related to our application
      APP_PID=$(pgrep -f $JAR_PATH)
      if [ -n "$APP_PID" ]; then
        echo "Stopping existing Java process with PID $APP_PID"
        kill -9 $APP_PID
      fi

      # Run the application
      echo "Starting application using $JAR_PATH"
      nohup java -Dfile.encoding=UTF-8 -jar $JAR_PATH > /var/log/app.log 2>&1 &

      echo "Application started with new PID: $!"
