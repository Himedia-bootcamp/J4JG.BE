files:
  "/sbin/appstart":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      #!/usr/bin/env bash

      # Kill existing java processes
      killall java || true

      # Define JAR paths
      GATEWAY_JAR_PATH=/var/app/current/gateway/build/libs/gateway-0.0.1-SNAPSHOT.jar
      BACKEND_JAR_PATH=/var/app/current/backend/build/libs/backend-0.0.1-SNAPSHOT.jar

      # Run the Gateway application on port 8000
      java -Dfile.encoding=UTF-8 -jar "$GATEWAY_JAR_PATH" --server.port=8000 &

      # Run the Backend application on port 5000
      java -Dfile.encoding=UTF-8 -jar "$BACKEND_JAR_PATH" --server.port=5000 &

      # Wait for both applications to start
      wait
